<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head>
  <head>
    <script defer src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>


    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4F8KTHDP9M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-4F8KTHDP9M');
    </script>
    
    
    
    <title>Ray Peat on the immune system</title>
    <meta charset="utf-8">
    <meta name="description" content="Explore the wisdom of Ray Peat by topics    " />
    <meta name="dc.relation" content="https://raypeatexplained.com" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#1A94D2" />

    

    
    <link rel="stylesheet" href="../css/styles.min.css" media="screen">

    
    <link rel='shortcut icon' type='image/x-icon' href='../favicon.ico' />
    
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore-compat.js"></script>

    <style>
         
        .search-box {
            margin-bottom: 20px;
            text-align: center;
        }

        .search-box input {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            min-width: calc(50% - 20px);
             
        }

        .highlight {
            background-color: yellow;
             
        }
    </style>

</head>
</head>

<body>


  <header class="">
          <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="https://raypeatexplained.com/">Ray Peat Explained</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link  " href="https://raypeatexplained.com/">Home</a>              </li>

              
              
          </div>
        </div>
      </nav>

  </header>
  <div class="container-fluid">
    <main>
      


<div class="container pb-5 mt-4">
  <h1 class="mb-3" style="text-transform: capitalize;">Ray Peat on the immune system</h1>
  
  
  
  
  <div class="search-box">
    <button class="btn btn-primary" id="sort-by-popularity">Sort by popularity</button>

    <input type="text" id="quoteSearch" placeholder="Search quotes...">
  </div>

 

  


  <div id="quotesContainer"> 
  <p>
<div class="quote"  data-upvotes="0" data-quote-id="80115400272308346954321248800225123937">
    <div id='80115400272308346954321248800225123937' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Immunity: Innate vs. Adaptive in Organisms</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"In the 1960s, when antibodies were being studied intensively, Metchnikoff’s approach was called innate immunity, something more primitive and undifferentiated than the evolutionarily more advanced adaptive immunity of the B and T cells, bone and thymus cells. At that time, however, an example of something like adaptive immunity, a learned response to a toxin, had already been demonstrated to exist in plants,"</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- January 2020 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('80115400272308346954321248800225123937')">Upvote</button>
          <span class="upvote-counter" id="80115400272308346954321248800225123937-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('80115400272308346954321248800225123937');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="87741350829115169051364681349127622601">
    <div id='87741350829115169051364681349127622601' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Inflammation&#39;s Role in Universal Pathology</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Up until the beginning of this century, inflammation had usually been thought of as a simply constructive part of the local healing process, but it was starting to be recognized to have a universal role in pathology. Tissue injury was no longer seen as a merely local event. Research was being forced toward a reconsideration of Metchnikoff’s holistic, developmental view of immunity. Bystander effects, the emission by any injured cell of substances that induce a similar injury in other cells, even in remote parts of the body (Koturbash, 2007; Kovalchuk, 2016), and the persistent epigenetic changes they involve, are part of innate immunity. This system is activated by adjuvants, as well as the adaptive immune system that produces antibodies."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- January 2020 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('87741350829115169051364681349127622601')">Upvote</button>
          <span class="upvote-counter" id="87741350829115169051364681349127622601-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('87741350829115169051364681349127622601');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="197700071433545519978771476758500188346">
    <div id='197700071433545519978771476758500188346' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Immune System: Restoration or Inflammation</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Our so-called immune system detects unfavorable changes in the structural-energetic system, and reacts quietly to restore the system, removing abnormal structures, and facilitating the restoration of function. When the organism’s situation isn’t good, instead of invisible restoration there is inflammation, a process in which crude provisional repairs are made, so that the damaged tissue doesn’t continue to demand resources that aren’t available. A scar is formed, a relatively inert fibrotic tissue replaces the fully functional tissue. This happens progressively with continued exposure to harmful factors, degrading the lungs, heart, blood vessels, gonads, liver, kidneys, brain ...."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2019 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('197700071433545519978771476758500188346')">Upvote</button>
          <span class="upvote-counter" id="197700071433545519978771476758500188346-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('197700071433545519978771476758500188346');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="298145219440222814460721659166018146364">
    <div id='298145219440222814460721659166018146364' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Inflammation&#39;s Role in Immunity and Disease Treatment</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"The doctrine that inflammation is a necessary part of immunity, leading to destruction of the pathogen, affects the way diseases are treated."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2021 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('298145219440222814460721659166018146364')">Upvote</button>
          <span class="upvote-counter" id="298145219440222814460721659166018146364-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('298145219440222814460721659166018146364');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="227469675642970115826354611639179836544">
    <div id='227469675642970115826354611639179836544' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">The Presumed Benefits of Traits Through Natural Selection</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Biologists usually say that any trait found in an organism is the result of natural selection, and the presumption is that it has been beneficial at some time in our history. This presumption tends to support the complex stories that textbooks tell about the role of inflammation in disease and immunity."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2021 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('227469675642970115826354611639179836544')">Upvote</button>
          <span class="upvote-counter" id="227469675642970115826354611639179836544-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('227469675642970115826354611639179836544');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="4529729320863026690435099893084146076">
    <div id='4529729320863026690435099893084146076' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Progesterone and Vitamin D in Nerve Function Recovery</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Studies of progesterone’s effects on recovery of nerve function after traumatic brain damage have found that vitamin D increases its effectiveness. By improving calcium homeostasis, opposing the effects of the parathyroid hormone which activates calcium channels, vitamin D (25-hydroxycholecalciferol) is coming to be considered a neurosteroid (Groves, et al., 2014; Gezen-Ak and Dursun, 2019), as well as an essential factor in immunity"</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- May 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('4529729320863026690435099893084146076')">Upvote</button>
          <span class="upvote-counter" id="4529729320863026690435099893084146076-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('4529729320863026690435099893084146076');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="36408018183116388545521389009440796180">
    <div id='36408018183116388545521389009440796180' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">The Overemphasis on Antibodies in Defining Immunity</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Focus on the induction of antibodies by vaccines to define immunity has led to a dangerous disregard for the basic facts of health."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- May 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('36408018183116388545521389009440796180')">Upvote</button>
          <span class="upvote-counter" id="36408018183116388545521389009440796180-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('36408018183116388545521389009440796180');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="13578378262970999372203189788125837269">
    <div id='13578378262970999372203189788125837269' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Historical Perspectives on Autoimmune Disease Treatment</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"The idea of autoimmune disease can be traced back to Paul Ehrlich’s theory of immunity, and his idea of a therapeutic magic bullet has dominated the medical approach to treating the autoimmune diseases."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- November 2016 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('13578378262970999372203189788125837269')">Upvote</button>
          <span class="upvote-counter" id="13578378262970999372203189788125837269-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('13578378262970999372203189788125837269');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="265365528736755680217588388771507552887">
    <div id='265365528736755680217588388771507552887' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Metchnikoff and Beyond: The Immune System&#39;s Harmony with the Microbiome</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"The embryologist Elie Metchnikoff looked at immunity as an aspect of the organism’s maintenance of its own integrity."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- November 2016 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('265365528736755680217588388771507552887')">Upvote</button>
          <span class="upvote-counter" id="265365528736755680217588388771507552887-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('265365528736755680217588388771507552887');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="64717733009059218963023751496345232965">
    <div id='64717733009059218963023751496345232965' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">The Evolution of Immunological Theories: A Holistic View</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Although the idea of a guiding organismic field that was held by most embryologists disappeared in the 1950s, in the 1990s a similar holistic view appeared in Matzinger’s danger theory and Cunliffe’s morphostasis or damage theory of immunity, in which destruction of pathogens isn’t the purpose of the immune system, but a side effect of maintaining organismic integrity"</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- November 2016 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('64717733009059218963023751496345232965')">Upvote</button>
          <span class="upvote-counter" id="64717733009059218963023751496345232965-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('64717733009059218963023751496345232965');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="298749890633745768965443167284858119901">
    <div id='298749890633745768965443167284858119901' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Cultural Acceptance of Suffering as Strengthening Practice</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Looking at the larger culture of western civilization, mortification of the flesh for the good of the soul might be a relevant context for these persistent attitudes in medicine and biology. Athletes are told no pain, no gain, and many people are accepting the idea that suffering toughens you in general ways—fasting, cold showers, jogging, are said to improve immunity and delay aging."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- November 2017 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('298749890633745768965443167284858119901')">Upvote</button>
          <span class="upvote-counter" id="298749890633745768965443167284858119901-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('298749890633745768965443167284858119901');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="266044726643441437258731347570315145788">
    <div id='266044726643441437258731347570315145788' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Bodily Experiences Influencing Vitality and Physiology</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Our bodies are constantly having experiences, and generalizing from them in the way they respond; these generalized responses can limit or expand our vitality. These generalizations are expressed in our anatomy, physiology, and ecosystems, with changes in immunity, metabolism, gene expression, and behavior."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- September 2017 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('266044726643441437258731347570315145788')">Upvote</button>
          <span class="upvote-counter" id="266044726643441437258731347570315145788-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('266044726643441437258731347570315145788');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="30540939412014254401264129884522373881">
    <div id='30540939412014254401264129884522373881' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Parathyroid Hormone&#39;s Role and Effects in Aging</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Phosphate, which predominates in grains, beans, nuts, meats, and fish, increases our production of parathyroid hormone, while calcium and magnesium inhibit its production. This hormone, which increases with age, suppresses immunity, and in excess it causes insomnia, seizures, dementia, psychosis, cancer, heart disease, respiratory distress and pulmonary hypertension, osteoporosis, sarcopenia, histamine release, inflammation and soft tissue calcification, and many other problems."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- September 2017 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('30540939412014254401264129884522373881')">Upvote</button>
          <span class="upvote-counter" id="30540939412014254401264129884522373881-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('30540939412014254401264129884522373881');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>
</p>

  </div>  
</div>


    </main>
    <footer>
      <footer class="footer fixed-bottom bg-dark">

    

  

  
  
  <script src="../js/bundle.min.js" defer></script>
      <script src="../js/main.f8356cbfc3b51bb24c286205b62461b46aaa5a219dac170a24f1692c6ff4154a.js" integrity="sha256-&#43;DVsv8O1G7JMKGIFtiRhtGqqWiGdrBcKJPFpLG/0FUo=" crossorigin="anonymous"></script>
</footer>
    </footer>
  </div>

  <script defer type="module">
    
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js';
    import { getFirestore, doc, onSnapshot, setDoc, updateDoc, increment, getDocs, collection, serverTimestamp, addDoc } from 'https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.1.0/firebase-auth.js';


    const firebaseConfig = {
      apiKey: "AIzaSyBNTOHPQHCasjzKwje2P78-q6p1hsXQkW4",
      authDomain: "ray-peat-explained.firebaseapp.com",
      projectId: "ray-peat-explained",
      storageBucket: "ray-peat-explained.appspot.com",
      messagingSenderId: "791071522728",
      appId: "1:791071522728:web:3df2e0f7e4c0b66d4a679d"
    };


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    async function signInAnonymouslyAndUpvote(upvote_id) {
      try {
        
        const userCredential = await signInAnonymously(auth);
        const user = userCredential.user;

        
        if (user) {
          console.log(`User is signed in anonymously with uid: ${user.uid}`);

          
          const upvoteData = {
            anonymousUserId: user.uid,
            upvote_id: upvote_id,
            timeOfUpvote: serverTimestamp(),
          };

          
          const docRef = await addDoc(collection(db, "upvotes"), upvoteData);
          console.log("Document written with ID: ", docRef.id);
        } else {
          console.log("User sign-in failed");
        }
      } catch (error) {
        const errorCode = error.code;
        const errorMessage = error.message;
        console.error(`Error code: ${errorCode}, Message: ${errorMessage}`);
      }
    }

    
    function setUpQuoteListener(quoteId) {
      const quoteRef = doc(db, "quotes", quoteId);

      onSnapshot(quoteRef, (docSnapshot) => {
        const upvotesSpan = document.getElementById(`${quoteId}-count`);
        if (docSnapshot.exists()) {
          upvotesSpan.textContent = docSnapshot.data().upvotes;
        } else {
          
          setDoc(quoteRef, { upvotes: 0 })
            .then(() => { upvotesSpan.textContent = "0"; })
            .catch((error) => {
              console.error("Error creating document: ", error);
            });
        }
      });
    }

    
    function upvote(quoteId) {
      const quoteRef = doc(db, "quotes", quoteId);

      
      updateDoc(quoteRef, {
        upvotes: increment(1)
      }).catch((error) => {
        console.error("Error updating document: ", error);
      });

      signInAnonymouslyAndUpvote(quoteId).catch((error) => {
        console.error("Error updating document II: ", error);
      });

    }

    
    window.upvote = upvote;

    
    document.addEventListener('DOMContentLoaded', () => {
      
      const quoteContainers = document.querySelectorAll('.quote-container');

      
      quoteContainers.forEach(container => {
        const quoteId = container.id;
        setUpQuoteListener(quoteId);
      });
    });

    document.getElementById("sort-by-popularity").addEventListener('click', async () => {
      try {
        
        const querySnapshot = await getDocs(collection(db, 'quotes'));
        const upvotesMap = new Map();  

        querySnapshot.forEach(doc => {
          
          upvotesMap.set(doc.id, doc.data().upvotes);
        });

        
        const quoteElems = document.querySelectorAll('.quote');

        
        quoteElems.forEach(quoteElem => {
          const quoteId = quoteElem.getAttribute('data-quote-id');
          const upvotes = upvotesMap.get(quoteId) || 0; 
          quoteElem.setAttribute('data-upvotes', upvotes);
        });

        
        const quoteArray = Array.from(quoteElems);
        quoteArray.sort((a, b) => {
          return b.getAttribute('data-upvotes') - a.getAttribute('data-upvotes');
        });

        
        const quotesContainer = document.getElementById('quotesContainer');
        quotesContainer.innerHTML = ''; 

        
        quoteArray.forEach(quote => {
          quotesContainer.appendChild(quote);
        });
      } catch (err) {
        console.error('Error fetching upvotes: ', err);
      }
    });

    window.copyLinkToClipboard = function copyLinkToClipboard(id) {
      
      const urlWithHash = `${window.location.href.split('#')[0]}#${id}`;
    
      
      navigator.clipboard.writeText(urlWithHash).then(() => {
        
      }).catch(err => {
        console.error("Could not copy text: ", err);
      });
    }

    window.highlightDiv=  function highlightDiv(hash) {
      
      document.querySelectorAll('.highlight-quote').forEach((el) => {
        el.classList.remove('highlight-quote');
      });
    
      
      if (hash !== '') {
        const id = hash.replace('#', '');
        const divToHighlight = document.getElementById(id);
        if (divToHighlight) {
          divToHighlight.classList.add('highlight-quote');
          console.log("Quote selected")
    
          
          divToHighlight.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      }
    }
    
    
    window.addEventListener('hashchange', () => window.highlightDiv(window.location.hash));
    window.addEventListener('DOMContentLoaded', () => window.highlightDiv(window.location.hash));
    
  </script>

</body>

</html>