<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head>
  <head>
    <script defer src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>


    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4F8KTHDP9M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-4F8KTHDP9M');
    </script>
    
    
    
    <title>Ray Peat on Gilbert Ling</title>
    <meta charset="utf-8">
    <meta name="description" content="Explore the wisdom of Ray Peat by topics    " />
    <meta name="dc.relation" content="https://raypeatexplained.com" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="theme-color" content="#1A94D2" />

    

    
    <link rel="stylesheet" href="../css/styles.min.css" media="screen">

    
    <link rel='shortcut icon' type='image/x-icon' href='../favicon.ico' />
    
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore-compat.js"></script>

    <style>
         
        .search-box {
            margin-bottom: 20px;
            text-align: center;
        }

        .search-box input {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            min-width: calc(50% - 20px);
             
        }

        .highlight {
            background-color: yellow;
             
        }
    </style>

</head>
</head>

<body>


  <header class="">
          <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <a class="navbar-brand" href="https://raypeatexplained.com/">Ray Peat Explained</a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link  " href="https://raypeatexplained.com/">Home</a>              </li>

              
              

            
            
            <li class="nav-item">
              <a class='nav-link'
                href="https://twitter.com/bioenergy_space" target="_blank">
                <b>Find out more on</b>
                <img src="../logo-black_hua600c2e15e1e097edc626e67450d6438_102327_20x0_resize_box_3.png" alt="Description" style="vertical-align: middle;">
                 
              </a>
            </li>
          </div>
        </div>
      </nav>

  </header>
  <div class="container-fluid">
    <main>
      


<div class="container pb-5 mt-4">
  <h1 class="mb-3" style="text-transform: capitalize;">Ray Peat on Gilbert Ling</h1>
  
  
  
  
  <div class="search-box">
    <button class="btn btn-primary" id="sort-by-popularity">Sort by popularity</button>

    <input type="text" id="quoteSearch" placeholder="Search quotes...">
  </div>

 

  


  <div id="quotesContainer"> 
  <p>
<div class="quote"  data-upvotes="0" data-quote-id="272008951359138462923942787709270483264">
    <div id='272008951359138462923942787709270483264' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Paradox of Lipid Bilayer Membrane Doctrine</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"The fact that cholesterol strengthens cells, keeping them from disintegrating under stress, obviously has nothing to do with a lipid bilayer membrane. That membrane doctrine has made it seem paradoxical that the loss of cholesterol should make cells stiffer, while weakening them. Gilbert Ling has, for 65 years, pointed out the numerous paradoxes confronted by the advocates of the lipid boundary membrane, but the membrane doctrine continues to govern"</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- September 2018 - Ray Peat&#39;s Newsletter </p>
        <button class="upvote-button" onclick="upvote('272008951359138462923942787709270483264')">Upvote</button>
          <span class="upvote-counter" id="272008951359138462923942787709270483264-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('272008951359138462923942787709270483264');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="254496486211692848038324995861234986156">
    <div id='254496486211692848038324995861234986156' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Evaluating Science in Ling&#39;s Era</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"I don’t think it’s possible to think about Gilbert Ling’s work (which began in the 1940s) without evaluating the way that the science industry has been working during this period, at least in the US and England. Science has its rules, but they don’t apply when the ruling ideology or paradigm is challenged."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('254496486211692848038324995861234986156')">Upvote</button>
          <span class="upvote-counter" id="254496486211692848038324995861234986156-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('254496486211692848038324995861234986156');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="318634194126113274618606997891580094205">
    <div id='318634194126113274618606997891580094205' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Ling&#39;s Living State Challenges Conventions</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"For many years, the science culture of the US has at times denounced holism, intentionality, consciousness, epigenetics, self-organization and self-regulation, along with vitalism, as unscientific and superstitious. In the 1960s, Gilbert Ling’s idea of a living state had overtones of holism and selfregulation, but one of the most offensive things about it was that it proposed to explain all biological processes in terms of known laws of physics and principles of physical chemistry."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('318634194126113274618606997891580094205')">Upvote</button>
          <span class="upvote-counter" id="318634194126113274618606997891580094205-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('318634194126113274618606997891580094205');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="146541738781731051178082870089199224532">
    <div id='146541738781731051178082870089199224532' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Active Transport and Role of ATP in Cells</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"The membrane theory says that the process of concentrating a substance against its gradient is active transport, and requires the use of ATP. Experiments by Ling and others showed that the energy metabolism of cells could be poisoned so that no ATP was being produced, but that cells were able to maintain their ionic gradient, although sodium was free to diffuse into the cell, through the membrane. All the ATP has to do is to be present, passively occupying its place in the cell."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('146541738781731051178082870089199224532')">Upvote</button>
          <span class="upvote-counter" id="146541738781731051178082870089199224532-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('146541738781731051178082870089199224532');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="57300442115080407133202307056766732383">
    <div id='57300442115080407133202307056766732383' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Ling&#39;s Perception of ATP Bond Energy</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Since Ling didn’t imagine that ATP bond energy was being consumed constantly to run membrane sodium pumps, he wasn’t concerned with any energy that might be released by hydrolyzing that bond. He, like Albert Szent-Gyorgyi, was aware that the ATP molecule adsorbs with considerable energy to protein molecules, and that its presence governs the shape of the protein molecule."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('57300442115080407133202307056766732383')">Upvote</button>
          <span class="upvote-counter" id="57300442115080407133202307056766732383-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('57300442115080407133202307056766732383');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="78075385366720452524342299539930356833">
    <div id='78075385366720452524342299539930356833' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Ling&#39;s Vision of the Living State</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"The image of the living state of matter that Ling had sketched out was now being surrounded by a rich landscape of information about colloids, gels, coacervates, liquid crystals, nanoscale surface effects, selforganization, and membraneless organelles."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('78075385366720452524342299539930356833')">Upvote</button>
          <span class="upvote-counter" id="78075385366720452524342299539930356833-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('78075385366720452524342299539930356833');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="244114252136441150672238244328186348752">
    <div id='244114252136441150672238244328186348752' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">CO2&#39;s Effect on Muscle Contraction and Brain Blood Flow</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"In the 1950s, Gilbert Ling noticed that in the presence of increased carbon dioxide, a given stimulus produces less contraction of a muscle than with a lower concentration of carbon dioxide. Around the same time, Russian physiologists found that the CO2 produced by active brain cells relaxes brain blood vessels, including capillaries, increasing the flow of blood in proportion to the increasing metabolic needs."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('244114252136441150672238244328186348752')">Upvote</button>
          <span class="upvote-counter" id="244114252136441150672238244328186348752-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('244114252136441150672238244328186348752');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="301922072699528938401676307653844662558">
    <div id='301922072699528938401676307653844662558' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Protein Interactions and Influence of Cardinal Adsorbents</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Everything that associates with a protein, such as potassium or ammonium, has an inductive effect on the protein’s structure and interactions with its surroundings, and substances that adsorb powerfully, especially ATP and steroids, have powerful influences on the properties of the system. Molecules that bind powerfully to proteins change the ways the proteins influence the properties of water, and the properties of water govern cells’ metabolism and their interactions with each other and with the environment. Ling called these influential binding molecules cardinal adsorbents."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('301922072699528938401676307653844662558')">Upvote</button>
          <span class="upvote-counter" id="301922072699528938401676307653844662558-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('301922072699528938401676307653844662558');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="70794471466967492923019154864513061654">
    <div id='70794471466967492923019154864513061654' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Holistic Metabolic Energy-Structure in Health and Cancer</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"In the 1960s, at the peak of the membrane craze, when Otto Warburg, Albert Szent-Gyorgyi, and Gilbert Ling talked about the difference between health and cancer in terms of holistic metabolic energy-structure interactions, their ideas were ridiculed. Many of their basic discoveries are now individually accepted, but seen in terms of the mechanical membrane/pump/receptor doctrine, their meaning isn’t accessible."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- March 2020 - Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('70794471466967492923019154864513061654')">Upvote</button>
          <span class="upvote-counter" id="70794471466967492923019154864513061654-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('70794471466967492923019154864513061654');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="155464662150529633619652298936688336272">
    <div id='155464662150529633619652298936688336272' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Cell Organization and Energy&#39;s Impact on Protein Solubility</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Many of the new observations related to seeing cells as self-organizing coacervate systems are reminiscent of Gilbert Ling’s observations. For example, ATP increases the solubility of proteins (Patel, et al., 2017), and when energy is depleted, some proteins come out of solution, forming membrane-less organelles, filaments, and granules."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- January 2021 - Ray Peat&#39;s Newsletter  </p>
        <button class="upvote-button" onclick="upvote('155464662150529633619652298936688336272')">Upvote</button>
          <span class="upvote-counter" id="155464662150529633619652298936688336272-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('155464662150529633619652298936688336272');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="124696264585409079315609807980020668306">
    <div id='124696264585409079315609807980020668306' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Carbon Dioxide&#39;s Limiting Effect on Nerve, Muscle Over-Excitation</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"Carbon dioxide limits the electrical depolarization of nerves and muscles, a phenomenon first discovered by Gilbert Ling. This prevents the over-excitation and exhaustion of brain cells and muscle cells, including the heart. The presence of carbon dioxide limits the formation of lactic acid. This explains the lactate paradox of high altitude exertion"</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- 1999 - December- Ray Peat&#39;s Newsletter</p>
        <button class="upvote-button" onclick="upvote('124696264585409079315609807980020668306')">Upvote</button>
          <span class="upvote-counter" id="124696264585409079315609807980020668306-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('124696264585409079315609807980020668306');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="152287116709837766728576162704626945903">
    <div id='152287116709837766728576162704626945903' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Insights from Decades of Research on Cell Physiology</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"n 1968 or 69, I had been reading the previous 50 years of research on celi physiology, and i saw that for 20 years, Gilbert Ling had been almost alone in offering a view of the cell that was physically possible."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- 1998 - Ray Peat&#39;s Newsletter - 4</p>
        <button class="upvote-button" onclick="upvote('152287116709837766728576162704626945903')">Upvote</button>
          <span class="upvote-counter" id="152287116709837766728576162704626945903-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('152287116709837766728576162704626945903');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>


<div class="quote"  data-upvotes="0" data-quote-id="287582583008794646806201420886661213652">
    <div id='287582583008794646806201420886661213652' class="quote-container" style="margin: 10px; padding: 5px; background-color: #f9f9f9; border-left: 4px solid #5a5a5a;">
        <b style="font-style: italic; color: #333;">Critique of Current Scientific Culture in Cell Studies</b>
        <p style="margin-bottom: 10px; font-size: 18px; color: #555;">"I have seen articles in major science journals that draw important conclusions from the nonexistent positive charge supposed to be on the outside of cells, and those things have got past the editors and referees because those ideas are so current 1n our scientific culture. Less blatant, but equally false, ideas are even more prevalent. The use of various microelectrode techniques has produced an abundance of information on cellular electrical responses, but with the exception of the work of Gilbert Ling and a few others, the meaning of the data is obscured by a huge culture of phantasy theories."</p>
        <p style="font-size: 16px; text-align: right; color: #777;">- 1998 - Ray Peat&#39;s Newsletter - 2</p>
        <button class="upvote-button" onclick="upvote('287582583008794646806201420886661213652')">Upvote</button>
          <span class="upvote-counter" id="287582583008794646806201420886661213652-count">0</span> upvotes
          <button class="btn btn-primary" onclick="copyLinkToClipboard('287582583008794646806201420886661213652');">Copy Link to Quote</button>
    </div>
    
    <hr style="border: 0; height: 1px; background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));">
</div>
</p>

  </div>  
</div>


    </main>
    <footer>
      <footer class="footer fixed-bottom bg-dark">

    

  

  
  
  <script src="../js/bundle.min.js" defer></script>
      <script src="../js/main.f8356cbfc3b51bb24c286205b62461b46aaa5a219dac170a24f1692c6ff4154a.js" integrity="sha256-&#43;DVsv8O1G7JMKGIFtiRhtGqqWiGdrBcKJPFpLG/0FUo=" crossorigin="anonymous"></script>
</footer>
    </footer>
  </div>

  <script defer type="module">
    
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js';
    import { getFirestore, doc, onSnapshot, setDoc, updateDoc, increment, getDocs, collection, serverTimestamp, addDoc } from 'https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.1.0/firebase-auth.js';


    const firebaseConfig = {
      apiKey: "AIzaSyBNTOHPQHCasjzKwje2P78-q6p1hsXQkW4",
      authDomain: "ray-peat-explained.firebaseapp.com",
      projectId: "ray-peat-explained",
      storageBucket: "ray-peat-explained.appspot.com",
      messagingSenderId: "791071522728",
      appId: "1:791071522728:web:3df2e0f7e4c0b66d4a679d"
    };


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    async function signInAnonymouslyAndUpvote(upvote_id) {
      try {
        
        const userCredential = await signInAnonymously(auth);
        const user = userCredential.user;

        
        if (user) {
          console.log(`User is signed in anonymously with uid: ${user.uid}`);

          
          const upvoteData = {
            anonymousUserId: user.uid,
            upvote_id: upvote_id,
            timeOfUpvote: serverTimestamp(),
          };

          
          const docRef = await addDoc(collection(db, "upvotes"), upvoteData);
          console.log("Document written with ID: ", docRef.id);
        } else {
          console.log("User sign-in failed");
        }
      } catch (error) {
        const errorCode = error.code;
        const errorMessage = error.message;
        console.error(`Error code: ${errorCode}, Message: ${errorMessage}`);
      }
    }

    
    function setUpQuoteListener(quoteId) {
      const quoteRef = doc(db, "quotes", quoteId);

      onSnapshot(quoteRef, (docSnapshot) => {
        const upvotesSpan = document.getElementById(`${quoteId}-count`);
        if (docSnapshot.exists()) {
          upvotesSpan.textContent = docSnapshot.data().upvotes;
        } else {
          
          setDoc(quoteRef, { upvotes: 0 })
            .then(() => { upvotesSpan.textContent = "0"; })
            .catch((error) => {
              console.error("Error creating document: ", error);
            });
        }
      });
    }

    
    function upvote(quoteId) {
      const quoteRef = doc(db, "quotes", quoteId);

      
      updateDoc(quoteRef, {
        upvotes: increment(1)
      }).catch((error) => {
        console.error("Error updating document: ", error);
      });

      signInAnonymouslyAndUpvote(quoteId).catch((error) => {
        console.error("Error updating document II: ", error);
      });

    }

    
    window.upvote = upvote;

    
    document.addEventListener('DOMContentLoaded', () => {
      
      const quoteContainers = document.querySelectorAll('.quote-container');

      
      quoteContainers.forEach(container => {
        const quoteId = container.id;
        setUpQuoteListener(quoteId);
      });
    });

    document.getElementById("sort-by-popularity").addEventListener('click', async () => {
      try {
        
        const querySnapshot = await getDocs(collection(db, 'quotes'));
        const upvotesMap = new Map();  

        querySnapshot.forEach(doc => {
          
          upvotesMap.set(doc.id, doc.data().upvotes);
        });

        
        const quoteElems = document.querySelectorAll('.quote');

        
        quoteElems.forEach(quoteElem => {
          const quoteId = quoteElem.getAttribute('data-quote-id');
          const upvotes = upvotesMap.get(quoteId) || 0; 
          quoteElem.setAttribute('data-upvotes', upvotes);
        });

        
        const quoteArray = Array.from(quoteElems);
        quoteArray.sort((a, b) => {
          return b.getAttribute('data-upvotes') - a.getAttribute('data-upvotes');
        });

        
        const quotesContainer = document.getElementById('quotesContainer');
        quotesContainer.innerHTML = ''; 

        
        quoteArray.forEach(quote => {
          quotesContainer.appendChild(quote);
        });
      } catch (err) {
        console.error('Error fetching upvotes: ', err);
      }
    });

    window.copyLinkToClipboard = function copyLinkToClipboard(id) {
      
      const urlWithHash = `${window.location.href.split('#')[0]}#${id}`;
    
      
      navigator.clipboard.writeText(urlWithHash).then(() => {
        
      }).catch(err => {
        console.error("Could not copy text: ", err);
      });
    }

    window.highlightDiv=  function highlightDiv(hash) {
      
      document.querySelectorAll('.highlight-quote').forEach((el) => {
        el.classList.remove('highlight-quote');
      });
    
      
      if (hash !== '') {
        const id = hash.replace('#', '');
        const divToHighlight = document.getElementById(id);
        if (divToHighlight) {
          divToHighlight.classList.add('highlight-quote');
          console.log("Quote selected")
    
          
          divToHighlight.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      }
    }
    
    
    window.addEventListener('hashchange', () => window.highlightDiv(window.location.hash));
    window.addEventListener('DOMContentLoaded', () => window.highlightDiv(window.location.hash));
    
  </script>

</body>

</html>